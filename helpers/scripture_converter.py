import sys, re, pprint

def verses2chapter(verses):
  # Figure out chapter
  refs = [x[0] for x in verses]
  chapter = ''
  for ref in refs:
    if re.compile('\d+:').match(ref):
      chapter = re.compile('(\d+):').match(ref).group(1)
      break
  if chapter == '': chapter = raw_input()
  return chapter


def s2scripts(s):
  # Input: '21 therefore all a b c d e f g h i j k l m n o p q men 22 are like grass 23 of the 0xc2 field'
  # Output: [('3:21a','therefore all a b c d e f g h '),
  #          ('3:21b','i j k l m n o p q men'),
  #          ('3:22','are like grass'),
  #          ('3:23','of the field')]
  
  
  verses = re.compile(r'([\d]+?:*)([^\d:]+)').findall(s)
  verses = [(x[0],x[1].strip()
                      .replace(chr(0xc2),'')
                      .replace(chr(0xa1),'')
                      .replace(chr(0xaa),''))
           for x in verses]
            
  chapter = verses2chapter(verses)
    
  chaptered_verses = []
  for ref,text in verses:
    if re.compile('\d+:').match(ref):
      chaptered_verses.append( (ref,text) )
    else:
      chaptered_verses.append( (chapter+':'+ref,text) )
  
  _verses = []
  for ref,words in chaptered_verses:
    n = len(words.split()) / 10 # number of sub verses
    if n>1:
      subverses = words.split(', ')
      for i,subverse in enumerate(subverses):
        _verses.append( (str(ref)+(chr(65+i)).lower(), subverse) )
    else:
      _verses.append( (ref, words) )
  return _verses

###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################
###############################################################################################

scripts = s2scripts( open(sys.argv[1]).read() )

next = '?'
prev_text = '? '
for i,(ref,text) in enumerate(scripts):
  chars=',;.-:'
  prev = ((scripts[i-1][1]).split()[-1] if i>0 else '?').strip(chars)
  first = (text.split()[0]).strip(chars)
  last = (text.split()[-1]).strip(chars)
  next = ((scripts[i+1][1]).split()[0] if (i+1)<len(scripts) else '?').strip(chars)
  print 'PFLN - '+ref+'\t'+', '.join([prev,first,last,next])
  addin = '' if 'a' in ref or 'b' in ref or 'c' in ref else "'"
  print 'pick3: '+text+'\t'+addin+ref
  print 'esv: '+prev_text+' '+text+'\tblanks'
  prev_text = str(text)


#pprint.pprint (scripts)



